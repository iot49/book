
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Power Supply &#8212; Electronics for IoT</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://iot49.org/projects/robot/02_supply.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Peripherals" href="03_peripherals.html" />
    <link rel="prev" title="STM32" href="01_stm32.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Electronics for IoT</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  ide49
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/install.html">
   Install
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/configuration.html">
   Configuration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/password.html">
     Change Password
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/backup.html">
     Backup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/timezone.html">
     Timezone
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/dns.html">
     Domain Name
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/https.html">
     Https &amp; Certificates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/samba.html">
     Samba File Server/Client
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/mosquitto.html">
     Mosquitto MQTT Broker
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/config/mount.html">
     Mount USB Drive
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/micropython.html">
   MicroPython
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/iot-kernel.html">
     IoT Kernel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/magics.html">
     Magics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/REPL.html">
     REPL prompt
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/dev_config.html">
     Device Configuration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/flash.html">
     Flashing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/compile.html">
     Compile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/micropython/mp_ext_c.html">
     External C modules
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../ide/app.html">
   Docker App
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/app/overview.html">
     Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../ide/app/customize.html">
     Customize
     <em>
      ide49
     </em>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/help.html">
   Help
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ide/changelog.html">
   Changelog
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tours &amp; Projects
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../balance.html">
   GPIO
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/01_parts.html">
     Parts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/02_circuit.html">
     Circuit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/03_code.html">
     MicroPython Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/04_display.html">
     Display
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/05_buttons.html">
     Buttons
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/06_ble.html">
     Bluetooth
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/07_app.html">
     Standalone App
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/08_hx711.html">
     “Precision” Scale
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../balance/09_ticks.html">
     Time Intervals
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../internet.html">
   Internet
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/wifi.html">
     WiFi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/sockets.html">
     Sockets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/requests.html">
     Requests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/mqtt.html">
     MQTT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/wireshark.html">
     Wireshark
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/ota.html">
     ESP32 OTA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../internet/encryption.html">
     Encryption
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../bluetooth.html">
   Bluetooth
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../bluetooth/ble_uart_esp32.html">
     BLE UART - esp32
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bluetooth/ble_uart_host.html">
     BLE UART Service - Host
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../bluetooth/eddystone.html">
     BLE Beacon Scanner
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../wifi-cop.html">
   WiFi Coprocessor
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../wifi-cop/overview.html">
     Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../wifi-cop/custom_c.html">
     Custom MicroPython
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../wifi-cop/rpc.html">
     RPC
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../wifi-cop/networking.html">
     Networking
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mqtt-plot.html">
   MQTT Plot
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mqtt-plot/examples.html">
     Examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mqtt-plot/docs.html">
     Documentation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../robot.html">
   Robot
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="00_overview.html">
     Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01_stm32.html">
     STM32
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Power Supply
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_peripherals.html">
     Peripherals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="07_pitch.html">
     Pitch Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03a_period.html">
     Encoder Readout
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rust.html">
   Rust
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rust/install.html">
     Install Rust
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rust/tour.html">
     Try Rust
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/iot49/iot49.org"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/iot49/iot49.org/issues/new?title=Issue%20on%20page%20%2Fprojects/robot/02_supply.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/iot49/iot49.org/edit/master/docs/projects/robot/02_supply.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/projects/robot/02_supply.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power-up">
   Power Up
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power-down">
   Power Down
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Power Supply</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power-up">
   Power Up
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power-down">
   Power Down
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="power-supply">
<h1>Power Supply<a class="headerlink" href="#power-supply" title="Permalink to this headline">#</a></h1>
<p>The unregulated supply voltage of the motor hat, nominally 12V, supplies the motors. A 5V switching regulator powers the Raspberry PI and the STM32. It also adds “bush-button on/off control”: pressing <code class="docutils literal notranslate"><span class="pre">SW1</span></code> pulls the enable pin of the regulator high, starting Raspberry PI and the STM32.</p>
<p>If pressed again, <code class="docutils literal notranslate"><span class="pre">SHUT_SN</span></code> goes low. This bin is monitored by the Raspberry PI which initiates a shutdown under software control and instructs the STM32 to pull <code class="docutils literal notranslate"><span class="pre">PWR_EN</span></code> low, turning off the supply.</p>
<figure class="align-default" id="robot-supply">
<a class="reference internal image-reference" href="../../_images/supply_sch.png"><img alt="../../_images/supply_sch.png" src="../../_images/supply_sch.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">Robot power supply. <em>Note:</em> although the maximum input voltage of the 5V regulator is 24V, the TB6612 motor controller (which shares the same input rail) is limited to 15V.</span><a class="headerlink" href="#robot-supply" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#robot-supply"><span class="std std-numref">Figure 25</span></a> shows the schematic diagram of the 5V power supply for the Raspberry PI and the STM32.</p>
<section id="power-up">
<h2>Power Up<a class="headerlink" href="#power-up" title="Permalink to this headline">#</a></h2>
<p>The 12V supply is always available when the Lithium battery is connected. Initially, the 5V output is off (0V). Pressing button <code class="docutils literal notranslate"><span class="pre">SW1</span></code> pulls the enable input (pin 4) of the regulator high through <code class="docutils literal notranslate"><span class="pre">R1</span></code>. Its output raises to 5V. After releasing the button, the enable input is kept high through resistor <code class="docutils literal notranslate"><span class="pre">R3</span></code>.</p>
</section>
<section id="power-down">
<h2>Power Down<a class="headerlink" href="#power-down" title="Permalink to this headline">#</a></h2>
<p>Powering down the robot requires support from both the Raspberry PI and the STM32. The code is in file</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>!cat $IOT_PROJECTS/robot/code/rpi/shutdown_monitor.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env python

# monitor shutdown button (GPIO13)
# sudo halt &amp; turn off power when pressed

from iot_device.pydevice import Pydevice
from gpiozero import Button
from serial import Serial
import os, requests, time


# sudo shutdown (supervisor call)
def shutdown():
    supervisor_ip = os.getenv(&quot;BALENA_SUPERVISOR_ADDRESS&quot;)
    api_key = os.getenv(&quot;BALENA_SUPERVISOR_API_KEY&quot;)
    url = f&quot;{supervisor_ip}/v1/shutdown?apikey={api_key}&quot;
    headers = { &#39;Content-Type&#39;: &#39;application/json&#39; }
    requests.post(url=url, headers=headers)


# run code on stm32
def exec_no_follow(cmd, dev=&#39;/dev/ttyAMA1&#39;):
    with Serial(dev, 115200, timeout=0.5, write_timeout=2, exclusive= True) as serial:
        pyd = Pydevice(serial)
        pyd.enter_raw_repl()
        pyd.exec_raw_no_follow(cmd)
        time.sleep(0.2)
        while serial.in_waiting:
            data = serial.read(serial.in_waiting)
            try:
                data = data.decode()
            except:
                pass
            print(f&quot;*** MCU: {data}&quot;)
            time.sleep(0.1)


# monitor pi poweroff pin (AUX=GPIO16) and cut 5V supply when low
def stm32_shutdown_monitor():
    exec_no_follow(
f&quot;&quot;&quot;
from pyb import Pin
from time import sleep

# wait for pi to signal it&#39;s down
power_off = Pin(&#39;AUX&#39;, mode=Pin.IN, pull=Pin.PULL_NONE)
while power_off.value() == 1:
    pass

# just for good measure
sleep(1)

# declaring as input first sets the initial value after configuring as output
shut_dn = Pin(&#39;PWR_EN&#39;, mode=Pin.IN, pull=Pin.PULL_UP)
shut_dn.value(1)
shut_dn = Pin(&#39;PWR_EN&#39;, mode=Pin.OUT_OD)
shut_dn.value(0)

# power is cut - we are dead!
&quot;&quot;&quot;)


# callback when shutdown button pressed
def shut_down_pi():
    stm32_shutdown_monitor()
    shutdown()


# wait for MOTOR_HAT power button press (GPIO13) to initiate shutdown
with Button(13, pull_up=True, bounce_time=0.1) as shut_dn:
    shut_dn.when_pressed = shut_down_pi
    # do this forever
    while True:
        # print(&quot;napping ...&quot;)
        time.sleep(60)
</pre></div>
</div>
</div>
</div>
<p>It works as follows: The Raspberry PI monitors <code class="docutils literal notranslate"><span class="pre">SHUT_DN</span></code> (GPIO13). Once a button press is detected, first starts a program on the STM32 and then shuts down Linux.</p>
<p>The STM32 is responsible for turning off power. Since shutting down Linux takes some time, it needs and indication from the Raspberry PI that it is off. The <code class="docutils literal notranslate"><span class="pre">AUX</span></code> pin (GPIO16) is configured (dtoverlay) to go when the Raspberry PI is off and monitored by the STM32. After the pin goes low, the STM32 waits for a brief period and then pulls <code class="docutils literal notranslate"><span class="pre">PWR_EN</span></code> low, disabling the 5V supply and consequently cutting power to the Raspberry PI and the STM32.</p>
<p>The TB6612 motor controller still has 12V power but is configured such that it won’t turn on the motors without inputs from the STM32. Hence power drain from the Lithium battery is minimal after disabling the 5V regulator.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "iot_kernel"
        },
        kernelOptions: {
            kernelName: "iot_kernel",
            path: "./projects/robot"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'iot_kernel'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01_stm32.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">STM32</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_peripherals.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Peripherals</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Bernhard Boser<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>